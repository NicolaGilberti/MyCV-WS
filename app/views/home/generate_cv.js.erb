function convertImgToBase64URL(url, callback, outputFormat){
    var img = new Image();
    img.crossOrigin = 'Anonymous';
    img.onload = function(){
        var canvas = document.createElement('CANVAS'),
            ctx = canvas.getContext('2d'), dataURL;
        canvas.height = img.height;
        canvas.width = img.width;
        ctx.drawImage(img, 0, 0);
        dataURL = canvas.toDataURL(outputFormat);
        callback(dataURL);
        canvas = null;
    };
    img.src = url;
}

sample = {
    firstName: "<%= session['data']['name'] %>",
    surname: "",
    addressLine: "-",
    postalCode: "-",
    municipality: "-",
    country: {
        code: "-",
        label: "<%= session['data']['hometown'] %>"
    },
    email: "<%= session['data']['email'] %>",
    telephoneList: [
        {
            contact: "-",
            use: {
                code: "-",
                label: "-"
            }
        },
        {
            contact: "-",
            use: {
                code: "-",
                label: "-"
            }
        }
    ],
    birthday: "<%= session['data']['birthday'] %>",
    gender: {
        code: "-",
        label: "<%= session['data']['gender'] %>"
    },
    photo: "", // Da vedere
    job: "<%= @position %>",
    workExperienceList: [
        {
            from: "<%= session['data']['work_from'] %>",
            to: "<%= session['data']['work_to'] %>",
            current: "-",
            position: "<%= session['data']['work_position'] %>",
            activities: "-",
            employer: {
                name: "<%= session['data']['work_org_name'] %>",
                addressLine: "-",
                postalCode: "-",
                municipality: "-",
                country: {
                    code: "-",
                    label: "-"
                }
            }
        }
    ],
    educationList: [
        {
            from: "<%= session['data']['education_from'] %>",
            to: "<%= session['data']['education_to'] %>",
            current: "-",
            title: "<%= session['data']['education_title'] %>",
            activities: "-",
            organization: {
                name: "<%= session['data']['education_org_name'] %>",
                municipality: "-",
                country: {
                    code: "-",
                    label: "-"
                }
            }
        }
    ],
    skills: {
        linguistic: [
            {
                description: {
                    code: "-",
                    label: "<%= session['data']['language_spoken'] %>"
                },
                proficiency: {
                    listening: "-",
                    reading: "-",
                    spokenInteraction: "-",
                    spokenProduction: "-",
                    writing: "-"
                },
                verifiedBy: "-"
            }
        ],
        communication: "<%= session['data']['communication_skills'] %>",
        organisational: "<%= session['data']['organisational_skills'] %>",
        computer: "<%= session['data']['it_languages'] %>",
        other: "<%= session['data']['other_skills'] %>",
        driving: ["<%= session['data']['driving_licence'] %>"]
    },
    achievementList: [
        {
            title: {
                code: "-",
                label: "-"
            },
            description: "<%= session['data']['biography'] %>"
        }
    ],
    options: {
        language: "en"
    }
}


convertImgToBase64URL('http://bit.ly/18g0VNp', function(base64Img){
    sample['photo'] = base64Img;
});

//sample = {
//    firstName: `<%= session['data']['name'] %>`,
//    surname: ``,
//    addressLine: `Via Palazzi 106`,
//    postalCode: `36090`,
//    municipality: ``,
//    country: {
//        code: `<%= session['data']['location'] %>`,
//        label: `<%= session['data']['location'] %>`
//    },
//    email: `<%= session['data']['email'] %>`,
//    telephoneList: [
//        {
//            contact: `+39 3259984572`,
//            use: {
//                code: `mobile`,
//                label: `Mobile`
//            }
//        },
//        {
//            contact: `+0453 726 352`,
//            use: {
//                code: `home`,
//                label: `Home`
//            }
//        }
//    ],
//    birthday: `<%= session['data']['birthday'] %>`,
//    gender: {
//        code: `<%= session['data']['gender'] %>`,
//        label: `<%= session['data']['gender'] %>`
//    },
//    photo: ``, // Da vedere
//    job: `<%= @position %>`,
//    workExperienceList: [
//        {
//            from: `<%= session['data']['work_from'] %>`,
//            to: `<%= session['data']['work_to'] %>`,
//            current: `true`,
//            position: `<%= session['data']['work_position'] %>`,
//            activities: 'I did things and stuff',
//            employer: {
//                name: `<%= session['data']['work_org_name'] %>`,
//                addressLine: `Via Palazzi 106`,
//                postalCode: `36090`,
//                municipality: ``,
//                country: {
//                    code: `IT`,
//                    label: `Italy`
//                }
//            }
//        }
//    ],
//    educationList: [
//        {
//            from: `<%= session['data']['education_from'] %>`,
//            to: `<%= session['data']['education_to'] %>`,
//            current: `false`,
//            title: `<%= session['data']['education_title'] %>`,
//            activities: `Lots of stuffs and sss`,
//            organization: {
//                name: `<%= session['data']['education_org_name'] %>`,
//                municipality: ``,
//                country: {
//                    code: `<%= session['data']['hometown'] %>`,
//                    label: ``
//                }
//            }
//        }
//    ],
//    skills: {
//        linguistic: [
//            {
//                description: {
//                    code: `<%= session['data']['language_spoken'] %>`,
//                    label: `<%= session['data']['language_spoken'] %>`
//                },
//                proficiency: {
//                    listening: `A1`,
//                    reading: `C2`,
//                    spokenInteraction: `B2`,
//                    spokenProduction: `C4`,
//                    writing: `C2`
//                },
//                verifiedBy: `GIGI`
//            }
//        ],
//        communication: `<%= session['data']['communication_skills'] %>`,
//        organisational: `<%= session['data']['organizational_skills'] %>`,
//        computer: `<%= session['data']['it_languages'] %>`,
//        other: `<%= session['data']['other_skills'] %>`,
//        driving: [`<%= session['data']['driving_licence'] %>`]
//    },
//    achievementList: [
//        {
//            title: {
//                code: `publications`,
//                label: `Publications`
//            },
//            description: ``
//        }
//    ],
//    options: {
//        language: `en`
//    }
//}

console.log(sample)

$.ajax({
        url: "https://cors-anywhere.herokuapp.com/http://compagniadenoialtri.altervista.org/enrico/sde/europass/api.php",
        method: "POST",
        data: sample,
        success: res => {
        let xhr = new XMLHttpRequest();
        xhr.open('POST', 'https://cors-anywhere.herokuapp.com/https://europass.cedefop.europa.eu/rest/v1/document/to/pdf-cv', true);
        xhr.setRequestHeader("Content-Type", "application/xml");
        xhr.setRequestHeader("Accept-Language", 'en');
        xhr.responseType = 'arraybuffer';
        xhr.onload = function (e) {
            if (this.status === 200) {
                let blob = new Blob([this.response], {type: "application/pdf"});
                let link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = "NOMEDOWNLOAD.pdf";
                link.click();
            }
        };
        xhr.send(res);
        }
});

//$.ajax({
//        url: "https://cors-anywhere.herokuapp.com/http://compagniadenoialtri.altervista.org/enrico/sde/europass/api.php",
//        method: "POST",
//        data: sample,
//        success: res => {
//        let xhr = new XMLHttpRequest();
//        xhr.open('POST', 'https://cors-anywhere.herokuapp.com/https://europass.cedefop.europa.eu/rest/v1/document/to/pdf-cv', true);
//        xhr.setRequestHeader("Content-Type", "application/xml");
//        xhr.setRequestHeader("Accept-Language", "en");
//        xhr.responseType = 'arraybuffer';
//        xhr.onload = function (e) {
//            if (this.status === 200) {
//                let blob = new Blob([this.response], {type: "application/pdf"});
//                let link = document.createElement('a');
//                link.href = window.URL.createObjectURL(blob);
//                link.download = "NOMEDOWNLOAD.pdf";
//                link.click();
//            }
//        };
//        xhr.send(res);
//      }
//});


//$.ajax({
//  url: "http://compagniadenoialtri.altervista.org/enrico/sde/europass/api.php",
//  method: "POST",
//  data: {data: sample},
//  success: res => {
//      console.log(res);
//  }
//});

//let xhr = new XMLHttpRequest();
//xhr.open('POST', 'https://europass.cedefop.europa.eu/rest/v1/document/to/pdf-cv', true);
//xhr.setRequestHeader("Content-Type", "application/xml");
//xhr.setRequestHeader("Accept-Language", 'en');
//xhr.responseType = 'arraybuffer';
//xhr.onload = function (e) {
//    if (this.status === 200) {
//        let blob = new Blob([this.response], {type: "application/pdf"});
//        let link = document.createElement('a');
//        link.href = window.URL.createObjectURL(blob);
//        link.download = "NOMEDOWNLOAD.pdf";
//        link.click();
//    }
//};
//xhr.send(jQuery.parseXML($("<p/>").html().text()));


//$.ajax({
//        url: "http://compagniadenoialtri.altervista.org/enrico/sde/europass/api.php",
//        method: "POST",
//        data: sample,
//        success: res => {
//          let xhr = new XMLHttpRequest();
//          xhr.open('POST', 'https://europass.cedefop.europa.eu/rest/v1/document/to/pdf-cv', true);
//          xhr.setRequestHeader("Content-Type", "application/xml");
//          xhr.setRequestHeader("Accept-Language", LANGUAGE);
//          xhr.responseType = 'arraybuffer';
//          xhr.onload = function (e) {
//              if (this.status === 200) {
//                  let blob = new Blob([this.response], {type: "application/pdf"});
//                  let link = document.createElement('a');
//                  link.href = window.URL.createObjectURL(blob);
//                  link.download = "NOMEDOWNLOAD.pdf";
//                  link.click();
//              }
//          };
//          xhr.send(res);
//}
//});